<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IC Dining</title>
    <style>
        #top-section {
            border: 1px solid #ccc; /* Add border around top section */
            padding: 10px; /* Add padding inside top section */
            width: 60%; /* Set width of top section */
            margin: 0 auto; /* Center align the top section */
            margin-bottom: 20px; /* Add some space below the top section */
            text-align: center; /* Center align text inside the top section */
        }
        #next-service {
            text-align: center; /* Center align the text */
            margin-bottom: 20px; /* Add some space below the header */
        }
        #viewing-header {
            text-align: center; /* Center align the text */
            margin-bottom: 20px; /* Add some space below the header */
        }
        #currently {
            text-align: center; /* Center align the text */
            margin-bottom: 20px; /* Add some space below the header */
        }
        #header {
            text-align: center; /* Center align the text */
            margin-bottom: 20px; /* Add some space below the header */
        }
        #service-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Center the buttons horizontally */
            margin-bottom: 20px; /* Add some space between buttons and other content */
        }
        button {
            font-size: 1.25em; /* Increase button size */
            margin: 5px; /* Add margin around buttons */
            max-width: 150px; /* Set max width for buttons */
            white-space: normal; /* Allow wrapping of button text */
            overflow-wrap: break-word; /* Wrap long words in button text */
            flex-basis: 50%; /* Set button width to 50% of container */
        }
        #menu-box {
            border: 1px solid #ccc; /* Add border around menu box */
            padding: 10px; /* Add padding inside menu box */
            width: 60%; /* Set width of menu box */
            margin: 0 auto; /* Center align the menu box */
            text-align: left; /* Align text inside menu box to the left */
        }

        @media (max-width: 1024px) {
            #top-section, #menu-box {
                width: 90%; /* Adjust width for smaller screens */
                margin: 0 auto 20px auto; /* Center align and add margin */
            }
        }

        @media (max-width: 768px) {
            #top-section, #menu-box {
                width: 95%; /* Adjust width for even smaller screens */
            }
        }
    </style>
</head>
<body>
    <h1 id="header">Cummings Dining Hall</h1>

    <div id="top-section">
        <div id="currently"></div>
        <div id="viewing-header"></div> <!-- New header for viewing current menu -->
    </div>

    <!-- Container for service buttons -->
    <div id="service-buttons"></div>

    <div id="menu-box">
        <div id="menu"></div>
    </div>
    <div id="next-service"></div>

    <script>
        // Your Google Calendar API key
        const apiKey = 'AIzaSyAgGt_ZjpjvBYI1r1Zus0OWUo1Qrf14GEU';

        // ID of the Google Calendar you want to fetch events from
        const calendarId = 'mail.ic.edu_fpdm731abrq0a6d64hv5v8992c@group.calendar.google.com';

        // Date for which you want to fetch events (e.g., today)
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const formattedToday = `${year}-${month}-${day}`;

        // Service keywords and their corresponding start and end times
        const services = [
            { name: 'Breakfast Service', startTime: '07:00', endTime: '10:30' },
            { name: 'Lunch Service', startTime: '11:00', endTime: '14:00' },
            { name: 'Afternoon Service', startTime: '14:00', endTime: '17:00' },
            { name: 'Dinner Service', startTime: '17:00', endTime: '20:00' },
            { name: 'Late Night Service', startTime: '20:00', endTime: '21:00' }
        ];

        // Function to convert time to 12-hour format
        function to12HourFormat(time) {
            const [hours, minutes] = time.split(':');
            const hour = parseInt(hours, 10);
            const suffix = hour >= 12 ? 'PM' : 'AM';
            const adjustedHour = hour % 12 || 12;
            return `${adjustedHour}:${minutes} ${suffix}`;
        }

        // Function to display menu items (meeting notes) for the given event
        function displayMenu(event) {
            if (event && event.description) {
                document.getElementById('menu').innerHTML = `<h2>Menu:</h2><p>${event.description}</p>`;
            } else {
                document.getElementById('menu').innerHTML = `<p>No menu available for this service.</p>`;
            }
        }

        // Fetch events from Google Calendar API
        fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${formattedToday}T00:00:00Z&timeMax=${formattedToday}T23:59:59Z`)
            .then(response => response.json())
            .then(data => {
                const events = data.items;
                // Create buttons for each event
                services.forEach(service => {
                    const event = events.find(event => event.summary === service.name);
                    if (event) {
                        const serviceButton = document.createElement('button');
                        serviceButton.textContent = service.name.split(' ')[0]; // Display only the first word of the service name
                        serviceButton.addEventListener('click', () => {
                            displayMenu(event);
                            document.getElementById('viewing-header').textContent = `*Viewing ${service.name}*`;
                        });
                        document.getElementById('service-buttons').appendChild(serviceButton); // Append buttons to "service-buttons" div
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching events:', error);
                document.getElementById('menu').innerHTML = `<p>Error fetching events: ${error.message}</p>`;
            });

        // Find the current service
        const currentService = services.find(service => {
            const startTime = new Date(`${formattedToday}T${service.startTime}:00`);
            const endTime = new Date(`${formattedToday}T${service.endTime}:00`);
            return today >= startTime && today < endTime;
        });

        // Display the current service or "No services currently available"
        if (currentService) {
            document.getElementById('currently').innerHTML = `<h2>Currently: ${currentService.name} (until ${to12HourFormat(currentService.endTime)})</h2>`;
            // Fetch events from Google Calendar API
            fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${formattedToday}T00:00:00Z&timeMax=${formattedToday}T23:59:59Z`)
                .then(response => response.json())
                .then(data => {
                    const currentEvent = data.items.find(event => event.summary === currentService.name);
                    displayMenu(currentEvent);
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    document.getElementById('menu').innerHTML = `<p>Error fetching events: ${error.message}</p>`;
                });
        } else {
            document.getElementById('currently').innerHTML = `<p>No services currently available.</p>`;
        }

        // Find the next service
        const nextService = services.find(service => {
            const startTime = new Date(`${formattedToday}T${service.startTime}:00`);
            return today < startTime;
        });

        // Display the name of the next service or "No upcoming service"
        if (nextService) {
            document.getElementById('next-service').innerHTML = `<h2>Next Service</h2><p>${nextService.name} (Opens at ${to12HourFormat(nextService.startTime)})</p>`;
        } else {
            document.getElementById('next-service').innerHTML = `<p>No upcoming service.</p>`;
        }
    </script>
</body>
</html>
